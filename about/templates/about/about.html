{% extends 'base.html' %}
{% load static %}

{% block title %}Quiénes Somos | LE WORK Constructora{% endblock %}

{# BLOQUE: extra_head - Añade CSS y precargas importantes para rendimiento y efectos #}
{% block extra_head %}
    <!-- Preconectar para Google Fonts para un mejor rendimiento de carga -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Precargar la fuente Oswald para evitar parpadeos (FOUT/FOIT) -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="preload" as="font" crossorigin>
    <!-- Incluir AOS CSS para animaciones al hacer scroll -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        /* Definición de keyframes para animaciones sutiles del Hero */
        @keyframes fadeInMoveUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInMoveUp 0.8s ease-out forwards;
            opacity: 0; /* Asegura que el elemento esté oculto antes de que empiece la animación */
        }
        /* Clases de retraso para el hero text, aplicadas directamente */
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        /* Color de fondo para la sección de texto de la tarjeta de equipo (similar al de la imagen) */
        /* Puedes definir un color 'brand-light-grey' en tu tailwind.config.js si es un color recurrente */
        .team-card-text-bg {
            background-color: #e8e8e8; /* Un gris muy claro, similar al de la imagen */
        }
    </style>
{% endblock %}


{% block content %}

    <!-- HERO SECTION: Mejorado con fondo dinámico, overlay y animaciones de texto -->
    <section id="hero-about" class="relative w-full h-64 md:h-80 flex items-center justify-center bg-primary-700 text-white overflow-hidden shadow-xl" aria-labelledby="hero-about-heading">
        <!-- Capa de imagen de fondo con efecto parallax sutil -->
        <div class="absolute inset-0 bg-cover bg-center bg-no-repeat transition-transform duration-500 ease-out z-0"
             style="background-image: url('{% static 'core/img/hero_about_bg.jpg' %}');" {# Asume una imagen de fondo específica para "Quiénes Somos" #}
             data-parallax-speed="0.2"> {# Data attribute para el script JS de parallax #}
            <!-- Overlay oscuro para asegurar la legibilidad del texto blanco sobre la imagen -->
            <div class="absolute inset-0 bg-primary-700 opacity-60"></div>
        </div>
        <!-- Contenido del Hero: Centrado y con animaciones de entrada -->
        <div class="container mx-auto px-4 text-center relative z-10">
            <h1 id="hero-about-heading" class="text-4xl md:text-6xl font-oswald font-extrabold leading-tight tracking-tight animate-fade-in-up"> {# drop-shadow-md eliminado #}
                {% if about_us and about_us.title %}{{ about_us.title }}{% else %}Nuestra Historia, Nuestro Compromiso.{% endif %}
            </h1>
        </div>
    </section>

    <!-- SECCIÓN PRINCIPAL "¿QUIÉNES SOMOS?" -->
    <section id="about-us-main" class="py-16 md:py-20 bg-brand-light-blue-gray" aria-labelledby="about-us-main-heading">
        <div class="container mx-auto px-4 lg:px-8">

            <!-- BREADCRUMBS: Para una mejor navegación y contextualización -->
            <nav class="mb-8 text-brand-gray" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2">
                    {# CORRECCIÓN: Cambiado {% url 'home' %} por la ruta estática '/' #}
                    <li><a href="/" class="hover:underline text-primary-500 transition-colors duration-200">Inicio</a></li>
                    <li class="text-brand-gray">/</li>
                    <li aria-current="page" class="font-semibold text-brand-dark">Quiénes Somos</li>
                </ol>
            </nav>

            <article class="bg-white p-8 md:p-12 rounded-xl shadow-xl mb-12" data-aos="fade-up" data-aos-duration="900"> {# Añadido data-aos #}
                <h2 id="about-us-main-heading" class="text-3xl md:text-4xl font-oswald font-bold text-brand-dark text-center mb-6">¿Quiénes Somos?</h2>
                {% if main_content %}
                    <p class="text-lg text-brand-dark leading-relaxed text-center md:text-left">{{ main_content|linebreaksbr }}</p>
                {% else %}
                    <p class="text-lg text-brand-gray leading-relaxed text-center md:text-left">No hay contenido principal para la sección Quiénes Somos. Por favor, añádelo en el panel de administración.</p>
                {% endif %}
            </article>

            <!-- SECCIÓN MISIÓN, VISIÓN, VALORES: Con iconos, animaciones escalonadas y hover -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12 mb-16">
                {# Card de Misión #}
                <div class="mvv-card-item group bg-white p-8 rounded-xl shadow-lg transform transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:shadow-primary-300/50"
                     data-aos="fade-up" data-aos-duration="800"> {# data-aos-delay se añadirá con JS #}
                    <h3 class="text-2xl font-oswald font-bold text-primary-700 mb-4 flex items-center"><i class="fas fa-bullseye mr-3 text-primary-500 text-2xl"></i>Misión</h3>
                    <p class="text-brand-dark text-base leading-relaxed">
                        {% if mission %}{{ mission|linebreaksbr }}{% else %}No hay misión configurada.{% endif %}
                    </p>
                </div>
                {# Card de Visión #}
                <div class="mvv-card-item group bg-white p-8 rounded-xl shadow-lg transform transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:shadow-primary-300/50"
                     data-aos="fade-up" data-aos-duration="800"> {# data-aos-delay se añadirá con JS #}
                    <h3 class="text-2xl font-oswald font-bold text-primary-700 mb-4 flex items-center"><i class="fas fa-eye mr-3 text-primary-500 text-2xl"></i>Visión</h3>
                    <p class="text-brand-dark text-base leading-relaxed">
                        {% if vision %}{{ vision|linebreaksbr }}{% else %}No hay visión configurada.{% endif %}
                    </p>
                </div>
                {# Card de Valores #}
                <div class="mvv-card-item group bg-white p-8 rounded-xl shadow-lg transform transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:shadow-primary-300/50"
                     data-aos="fade-up" data-aos-duration="800"> {# data-aos-delay se añadirá con JS #}
                    <h3 class="text-2xl font-oswald font-bold text-primary-700 mb-4 flex items-center"><i class="fas fa-handshake mr-3 text-primary-500 text-2xl"></i>Valores</h3>
                    <ul class="space-y-3">
                        {% for value in values %}
                            <li class="flex items-start text-brand-dark text-base">
                                {% if value.icon %}
                                    {# Mejora: Añadido width/height para CLS. Asegurado object-contain si el icono no es una imagen de contenido. #}
                                    <img src="{{ value.icon.url }}" alt="Icono de {{ value.name }}" class="w-6 h-6 mr-3 flex-shrink-0 object-contain" width="24" height="24" loading="lazy">
                                {% else %}
                                    {# Mejora: Tamaño del icono ajustado para que encaje mejor con el texto. #}
                                    <i class="fas fa-check-circle text-primary-500 text-lg mr-3 flex-shrink-0" aria-hidden="true"></i>
                                {% endif %}
                                {{ value.name }}
                            </li>
                        {% empty %}
                            <li class="text-brand-gray text-base">No hay valores configurados.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- SECCIÓN EL EQUIPO: Con diseño de tarjeta de la imagen, animaciones escalonadas y optimización de imágenes -->
            <section id="team" class="bg-white p-8 md:p-12 rounded-xl shadow-xl mb-12" data-aos="fade-up" data-aos-duration="900" data-aos-delay="150" aria-labelledby="team-heading">
                <h2 id="team-heading" class="text-3xl md:text-4xl font-oswald font-bold text-brand-dark text-center mb-10">El Equipo</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 md:gap-10 justify-items-center">
                    {% for member in team_members %}
                        <article class="team-member-card-item group w-full max-w-xs rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:shadow-primary-300/50"
                                 data-aos="fade-up" data-aos-duration="800"> {# data-aos-delay se añadirá con JS #}
                            <a href="#" aria-label="Ver perfil de {{ member.name }}" class="block"> {# Añadido un enlace envolvente para toda la tarjeta #}
                                <div class="relative overflow-hidden bg-white rounded-t-xl"> {# Contenedor de la imagen #}
                                    {% if member.image %}
                                        {# Mejora: Añadido width/height para CLS. Alt text más descriptivo. #}
                                        {# Usamos object-contain si la imagen puede ser un logo para evitar recorte #}
                                        <img src="{{ member.image.url }}" alt="Retrato de {{ member.name }}"
                                             class="w-full h-56 {% if member.is_logo %}object-contain p-4{% else %}object-cover{% endif %} object-center rounded-t-xl transition-transform duration-300 group-hover:scale-105"
                                             width="300" height="224" loading="lazy">
                                    {% else %}
                                        {# Mejora: Placeholder más específico con alt. #}
                                        <img src="{% static 'core/img/team_member_placeholder.jpg' %}" alt="Imagen de perfil por defecto para {{ member.name }}"
                                             class="w-full h-56 object-cover object-center rounded-t-xl transition-transform duration-300 group-hover:scale-105"
                                             width="300" height="224" loading="lazy">
                                    {% endif %}
                                    {# Overlay sutil en hover para indicar interacción con la imagen #}
                                    <div class="absolute inset-0 bg-primary-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300 flex items-center justify-center">
                                        <svg class="h-12 w-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="p-6 text-center team-card-text-bg"> {# Fondo gris claro para el área de texto #}
                                    <h3 class="text-xl font-oswald font-semibold text-brand-dark mb-1 group-hover:text-primary-700 transition-colors duration-200">{{ member.name }}</h3>
                                    <p class="text-primary-600 text-sm font-medium mb-3 group-hover:text-primary-800 transition-colors duration-200">{{ member.title }}</p>
                                    {% if member.bio %}
                                        <p class="text-brand-gray text-sm leading-relaxed">{{ member.bio|truncatechars:100 }}</p>
                                    {% endif %}
                                </div>
                            </a>
                        </article>
                    {% empty %}
                        <p class="col-span-full text-center text-lg text-brand-gray p-6 bg-neutral-100 rounded-lg shadow-inner border border-neutral-gray/20"
                           data-aos="fade-in" data-aos-duration="1000" data-aos-delay="200">No hay miembros del equipo configurados.</p>
                    {% endfor %}
                </div>
            </section>

            <!-- SECCIÓN DE TESTIMONIOS: Con semántica correcta y animaciones escalonadas y efectos creativos -->
            <section id="testimonials" class="bg-white p-8 md:p-12 rounded-xl shadow-xl" data-aos="fade-up" data-aos-duration="900" data-aos-delay="300" aria-labelledby="testimonials-heading">
                <h2 id="testimonials-heading" class="text-3xl md:text-4xl font-oswald font-bold text-brand-dark text-center mb-10">Testimonios</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-10 justify-items-center">
                    {% for testimonial in testimonials %}
                        {# Tarjeta de testimonio más compacta y con efectos dinámicos #}
                        <blockquote class="testimonial-card-item group relative bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center transform transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:shadow-primary-300/50 overflow-hidden"
                                 data-aos="fade-up" data-aos-duration="800"> {# data-aos-delay se añadirá con JS #}
                            {# Ícono de cita grande y sutil en el fondo, con animación en hover #}
                            {# Se usa un tamaño 'text-7xl' para que sea grande, 'opacity-20' para que sea sutil #}
                            {# 'z-0' para que esté detrás del contenido, y 'transform translate-x-2 translate-y-2 rotate-12' para un inicio fuera de lugar #}
                            {# 'group-hover:rotate-0 group-hover:translate-x-0 group-hover:translate-y-0' para la animación al pasar el ratón #}
                            <i class="fas fa-quote-right absolute bottom-2 right-2 text-primary-300 text-7xl opacity-20 z-0 transform translate-x-2 translate-y-2 rotate-12 transition-transform duration-500 group-hover:rotate-0 group-hover:translate-x-0 group-hover:translate-y-0"></i>

                            {% if testimonial.image %}
                                {# Imagen del avatar más pequeña, con borde, sombra y animación en hover #}
                                {# 'w-20 h-20' es 80px. 'border-4 border-primary-500' para un marco distintivo #}
                                {# 'relative z-10' para asegurar que el avatar esté encima del icono de cita #}
                                <img src="{{ testimonial.image.url }}" alt="Avatar de {{ testimonial.client_name }}"
                                     class="w-20 h-20 rounded-full object-cover border-4 border-primary-500 shadow-md mb-4 relative z-10 transform transition-transform duration-300 group-hover:scale-105 group-hover:shadow-lg"
                                     width="80" height="80" loading="lazy">
                            {% else %}
                                {# Placeholder para avatar, con los mismos estilos y animaciones #}
                                <img src="{% static 'core/img/avatar_placeholder.jpg' %}" alt="Avatar por defecto"
                                     class="w-20 h-20 rounded-full object-cover border-4 border-primary-500 shadow-md mb-4 relative z-10 transform transition-transform duration-300 group-hover:scale-105 group-hover:shadow-lg"
                                     width="80" height="80" loading="lazy">
                            {% endif %}

                            {# Contenido del testimonio con tamaño de texto ajustado y animación en hover #}
                            {# 'text-lg md:text-xl' para mejor legibilidad. 'group-hover:scale-102' para un zoom sutil #}
                            <p class="text-brand-dark text-lg md:text-xl italic mb-4 relative z-10 transform transition-transform duration-300 group-hover:scale-102">"{{ testimonial.content|linebreaksbr }}"</p>
                            
                            {# Autor del testimonio, empujado al final si las alturas varían #}
                            {# 'mt-auto' es crucial para que el footer se alinee abajo si las alturas de las quotes varían #}
                            <footer class="mt-auto relative z-10">
                                <cite class="testimonial-author block text-primary-700 font-semibold text-base not-italic">— {{ testimonial.client_name }}</cite>
                            </footer>
                        </blockquote>
                    {% empty %}
                        <p class="col-span-full text-center text-lg text-brand-gray p-6 bg-neutral-100 rounded-lg shadow-inner border border-neutral-gray/20"
                           data-aos="fade-in" data-aos-duration="1000" data-aos-delay="200">No hay testimonios configurados para esta sección.</p>
                    {% endfor %}
                </div>
            </section>

        </div>
    </section>

{% endblock %}

{# BLOQUE: extra_js - Scripts JavaScript al final del body para no bloquear la renderización #}
{% block extra_js %}
    <!-- Incluir AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Script para efecto Parallax sutil en el Hero
            const parallaxBg = document.querySelector('[data-parallax-speed]');
            if (parallaxBg) {
                const speed = parseFloat(parallaxBg.dataset.parallaxSpeed);
                window.addEventListener('scroll', function() {
                    const yOffset = window.pageYOffset;
                    // Mover la imagen de fondo en la dirección opuesta al scroll
                    parallaxBg.style.transform = `translateY(${yOffset * speed}px)`;
                });
            }

            // Script para añadir retrasos escalonados (staggered delay) a las cards de Misión/Visión/Valores
            const mvvCards = document.querySelectorAll('.mvv-card-item');
            mvvCards.forEach((card, index) => {
                const delay = index * 150; // Ajusta el multiplicador para un efecto más rápido/lento
                card.setAttribute('data-aos-delay', delay);
            });

            // Script para añadir retrasos escalonados a las cards de Miembros del Equipo
            const teamMemberCards = document.querySelectorAll('.team-member-card-item');
            teamMemberCards.forEach((card, index) => {
                const delay = index * 100; // Ajusta el multiplicador
                card.setAttribute('data-aos-delay', delay);
            });

            // Script para añadir retrasos escalonados a las cards de Testimonios
            const testimonialCards = document.querySelectorAll('.testimonial-card-item');
            testimonialCards.forEach((card, index) => {
                const delay = index * 120; // Ajusta el multiplicador
                card.setAttribute('data-aos-delay', delay);
            });


            // Inicializa AOS después de que todos los data-aos-delay han sido establecidos
            AOS.init({
                once: true, // Animaciones solo una vez por elemento
                mirror: false, // Animaciones no se repiten al volver
            });
        });
    </script>
{% endblock %}